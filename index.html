<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ramu Kiranam - Milk Store</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body { font-family: Arial; background:#f4f6f9; padding:15px; }
.card { background:white; padding:15px; margin-bottom:12px; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.1);}
button { padding:10px; width:100%; margin-top:5px; border:none; border-radius:8px; background:#1976d2; color:white; cursor:pointer;}
.grand-total { background:#2e7d32; color:white; padding:15px; border-radius:12px; font-size:20px; text-align:center;}
</style>
</head>

<body>

<h2>ðŸ›’ Ramu Kiranam ðŸ¥›</h2>

<div class="card">
<h3>Enter Admin Password</h3>
<input type="password" id="adminPass" placeholder="Enter Password">
<button onclick="checkPassword()">Unlock</button>
<p id="status"></p>
</div>

<div id="mainContent" style="display:none;">

<div class="card">
<input type="date" id="entryDate">
</div>

<button id="saveBtn">Save Entry</button>
<button id="loadBtn">Load Entry</button>

<div id="products"></div>

<div class="card">
Oil Minus:
<input type="number" id="oilMinus" value="0">
</div>

<div class="grand-total">
Total â‚¹ <span id="grandTotal">0</span>
</div>

</div>

<script>

const ADMIN_PASSWORD = "1234";  // ðŸ”¥ CHANGE THIS TO YOUR PASSWORD

function checkPassword() {
  const entered = document.getElementById("adminPass").value;
  if (entered === ADMIN_PASSWORD) {
    document.getElementById("mainContent").style.display = "block";
    document.getElementById("status").innerText = "Unlocked âœ…";
  } else {
    document.getElementById("status").innerText = "Wrong Password âŒ";
  }
}

const firebaseConfig = {
  apiKey: "AIzaSyDuT-uXEbATKcPd3Smk1oysNih_lplFCwo",
  authDomain: "ramu-kiranam-milk.firebaseapp.com",
  projectId: "ramu-kiranam-milk",
  storageBucket: "ramu-kiranam-milk.firebasestorage.app",
  messagingSenderId: "19072712472",
  appId: "1:19072712472:web:e9b871c2c02bc927df686d"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

document.getElementById("entryDate").value =
  new Date().toISOString().split("T")[0];

const products = [
  { name:"Thirumala Gold 500ml", price:37 },
  { name:"Mulkanoor Gold 500ml", price:35.5 },
  { name:"Plain 500ml", price:27 },
  { name:"Gold 200ml", price:13 },
  { name:"Curd 1kg", price:48 }
];

const container = document.getElementById("products");

products.forEach(p=>{
  const div=document.createElement("div");
  div.className="card";
  div.innerHTML=`
  <strong>${p.name}</strong><br>
  Price â‚¹${p.price}<br>
  Quantity <input type="number" min="0" value="0" data-price="${p.price}">
  `;
  container.appendChild(div);
});

function calculate(){
  let total=0;
  document.querySelectorAll("#products input").forEach(i=>{
    total+=(Number(i.value)||0)*Number(i.dataset.price);
  });
  total-=Number(document.getElementById("oilMinus").value)||0;
  if(total<0) total=0;
  document.getElementById("grandTotal").innerText=total;
}

document.addEventListener("input",calculate);

document.getElementById("saveBtn").onclick=async()=>{
  const date=document.getElementById("entryDate").value;
  let items=[]; let total=0;

  document.querySelectorAll("#products input").forEach((i,index)=>{
    const qty=Number(i.value)||0;
    if(qty>0){
      const price=Number(i.dataset.price);
      items.push({name:products[index].name,qty,price});
      total+=qty*price;
    }
  });

  const oilMinus=Number(document.getElementById("oilMinus").value)||0;

  await db.collection("milkEntries").doc(date).set({
    date,items,oilMinus,total:total-oilMinus
  });

  alert("Saved Successfully");
};

document.getElementById("loadBtn").onclick=async()=>{
  const date=document.getElementById("entryDate").value;
  const snap=await db.collection("milkEntries").doc(date).get();
  if(!snap.exists) return alert("No Data");

  const data=snap.data();
  document.querySelectorAll("#products input").forEach(i=>i.value=0);

  data.items.forEach(item=>{
    products.forEach((p,index)=>{
      if(p.name===item.name){
        document.querySelectorAll("#products input")[index].value=item.qty;
      }
    });
  });

  document.getElementById("oilMinus").value=data.oilMinus||0;
  calculate();
  alert("Loaded");
};

</script>

</body>
</html>
